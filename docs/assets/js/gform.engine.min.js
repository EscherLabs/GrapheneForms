var gform=function(t,e){"use strict";this.fieldMethods=_.reduce(gform.field,(t,e,i)=>(t[i]=e(this),t),{}),this.call=(t,e,...i)=>(e[t]||gform.types[e.type||"text"][t]).call(e,e,...i),this.bind=(t,e,...i)=>(e[t]||gform.types[e.type||"text"][t]).bind(e,...i),this.updateActions=function(t){var e=t.parent.filter({array:{ref:t.array.ref}},1).length,i=function(t,e,i){gform.toggleClass(i.querySelector(t),"hidden",e)};"auto"==t.array.duplicate.enable&&_.each(t.operator.container.querySelectorAll(".gform_isArray"),i.bind(null,'[data-ref="'+t.array.ref+'"] .gform-add',e>=(t.array.max||5))),"auto"==t.array.remove.enable&&_.each(t.operator.container.querySelectorAll(".gform_isArray"),i.bind(null,'[data-ref="'+t.array.ref+'"] .gform-minus',!(e>(t.array.min||1)))),"auto"==t.array.append.enable&&i.call(null,'[data-ref="'+t.array.ref+'"].gform-append',e>=(t.array.max||5),t.operator.container)};var i=_.merge({},t);this.methods=i.methods||{},this.eventBus=new gform.eventBus({owner:"form",item:"field",handlers:i.events||{}},this),this.on=this.eventBus.on,this.dispatch=this.eventBus.dispatch,this.trigger=function(t,e,i){"string"==typeof t&&(t=[t]);var s=_.extend([],t);"object"==typeof e&&"owner"in e&&e.owner instanceof gform&&_.each(t,function(t){if("-1"==t.indexOf(":")){s.unshift(t+":"+e.name),s.unshift(t+":"+e.path),s.unshift(t+":"+e.relative);for(var i=e;"parent"in i&&!1!==i.parent;)i=i.parent,s.push(t+":"+i.name),s.push(t+":"+i.path),s.push(t+":"+i.relative)}}.bind(this)),this.dispatch(_.uniq(s),e,i)}.bind(this),this.errors={},this.popin=function(){},this.on("reset",(function(t){t.form.set(t.form.options.data)})),this.on("clear",(function(t){t.form.set()})),"object"==typeof i.collections?this.collections=i.collections:this.collections=gform.collections,this.options={fields:[],legend:"",strict:!0,data:"search",columns:gform.columns,name:gform.getUID(),...this.options,...i},"function"==typeof this.options.onSet&&(i=this.options.onSet(i)),this.options.fields=(this.options.fields||[]).concat(this.options.actions),"string"==typeof this.options.data&&(void 0!==window.location[this.options.data]?this.options.data=window.location[this.options.data].substr(1).split("&").map((function(t){return t.split("=")})).reduce((function(t,e){return t[e[0]]=decodeURIComponent(e[1]),t}),{}):gform.ajax({path:(this.options.rootpath||"")+this.options.data,success:function(t){this.set(t)}.bind(this)})),this.options.sections&&_.each(_.filter(this.options.fields,{type:"fieldset"}),(function(t,e){return t.index=e,t.section=!0,t.id=t.id||gform.getUID(),t})),this.el=e||i.el,"string"==typeof this.el?(this.selector=this.el+"",this.el=document.querySelector(this.el)):"object"==typeof this.el?this.el:e="",this.trigger("initialize",this);var s=function(){void 0===this.el&&(this.options.renderer="modal",this.el=gform.create(gform.render(this.options.template||"modal_container",this.options)),this.on("close",(function(t){void 0===t.field&&t.form.modal("hide")})),this.el.querySelector(".close").addEventListener("click",function(t){this.trigger("cancel",this)}.bind(this)),document.addEventListener("keyup",function(t){"Escape"===t.key&&this.trigger("cancel",this)}.bind(this))),this.options.clear&&"modal"!=this.options.renderer&&(this.el.innerHTML=gform.render(this.options.sections+"_container",this.options)),this.container=this.el.querySelector("form")||this.el,this.rows=[],this.newadd=this.fieldMethods.cultivate.bind(null,{data:this.options.data}),this.items=_.map(this.options.fields,this.newadd),this.fields=_.reduce(this.items,(t,e)=>("am"===e.type?t=t.concat(e.instances):t.push(e),t),[]),this.reflow(),gform.each.call(this,gform.addConditions),gform.each.call(this,(function(t){t.owner.trigger("change",t)})),this.options.private||(void 0!==gform.instances[this.options.name]&&gform.instances[this.options.name]!==this&&gform.instances[this.options.name].destroy(),gform.instances[this.options.name]=this)};this.infoEl=gform.create(gform.render("_tooltip")),this.infoEl.querySelector(".info-close").addEventListener("click",function(t){this.el.removeChild(this.infoEl),this.popper.destroy(),this.popper=null}.bind(this)),this.popper=null,["toJSON","toString","reflow","find","filter"].map(t=>{this[t]=gform[t].bind(this)}),this.restore=s.bind(this),this.get=this.toJSON,this.set=function(t,e){return"function"==typeof this.options.onSet&&(e=this.options.onSet(e)),"string"==typeof t&&this.find(t).set(e),"object"==typeof t&&_.each(t,function(t,e){var i=this.find(e);if(void 0!==i&&i.fillable)if(i.array&&_.isArray(t)){var s=this.filter({array:{ref:i.array.ref}},1);s.length>1&&_.each(s.slice(1),(function(t){var e=_.findIndex(t.parent.fields,{id:t.id});t.parent.fields.splice(e,1)})),_.isArray(t)&&i.set(t[0]);var o={};o[i.name]=t,gform.inflate.call(this.owner||this,o,i,_.findIndex(i.parent.fields,{id:i.id}),i.parent.fields),this.updateActions(i),i.operator.reflow()}else void 0!==i&&i.set(t)}.bind(this)),null==t&&gform.each.call(this,(function(t){t.set("")})),this.trigger("set"),this}.bind(this),this.isActive=!1,this.destroy=function(){this.isActive=!1,this.trigger(["close","destroy"]),this.el.removeEventListener("click",this.listener),this.el.innerHTML="",delete gform.instances[this.options.name],this.trigger("destroyed"),delete this.eventBus},s.call(this);var o=this.el.querySelector("ul.tabs");(null!==o&&o.addEventListener("click",function(t){"LI"==t.target.nodeName&&(t.preventDefault(),gform.removeClass(this.el.querySelector("ul.tabs .active"),"active"),gform.removeClass(this.el.querySelector(".tab-pane.active"),"active"),gform.addClass(t.target,"active"),gform.addClass(this.el.querySelector(t.target.parentElement.attributes.href.value),"active"))}.bind(this)),this.options.autoFocus&&this.fields.length)&&(this.find({visible:!0})&&window.setTimeout(gform.types[this.find({visible:!0}).type].focus.bind(this.find({visible:!0})),0));return this.listener=function(t){var e=t.target;if(t.target.classList.value.indexOf("gform-")<0&&t.target.parentElement.classList.value.indexOf("gform-")>=0&&(e=t.target.parentElement),void 0!==e.dataset.id&&void 0===(s=gform.findByID.call(this,e.dataset.id)))return console.error("Field not found with id:"+e.dataset.id),!1;if(e.classList.contains("gform-add")){t.stopPropagation(),t.preventDefault();var i=s.am.addField(null,s);1==i.array.duplicate.clone&&i.set(s.get())}if(e.classList.contains("gform-minus")&&(t.stopPropagation(),t.preventDefault(),s.am.removeField(s)),e.classList.contains("gform-append")){t.stopPropagation(),t.preventDefault();var s=gform.addField.call(this,_.last((this.find({id:e.dataset.parent})||this).filter({array:{ref:e.dataset.ref}},10)));this.trigger("appended",s)}if(e.classList.contains("gform-info")&&(t.stopPropagation(),t.preventDefault(),s.infoEl)){var o=!0;null!==this.popper&&(o=this.popper.state.elements.reference!=e,this.el.removeChild(this.infoEl),this.popper.destroy(),this.popper=null),o&&(this.infoEl.querySelector(".tooltip-body").innerHTML=gform.render("_info",s),this.popper=Popper.createPopper(t.target,this.infoEl,{placement:"top-end",modifiers:[{name:"offset",options:{offset:[0,8]}}]}),this.el.appendChild(this.infoEl))}}.bind(this),this.el.addEventListener("click",this.listener),this.trigger("initialized",this),this.isActive=!0,this.reflow(),this};gform.reflow=function(){(this.isActive||void 0!==this.owner&&this.owner.isActive)&&(_.each(this.rows,function(t,e){if(void 0!==t)try{t.container.removeChild(t.ref)}catch(t){}}.bind(this)),this.rows=[],gform.each.call(this,(function(t){t.section?t.section&&t.owner.el.querySelector("."+t.owner.options.sections+"-content").appendChild(t.el):gform.layout.call(this,t)})))};
gform.types={input:{base:"input",defaults:{},row:function(){return"<div></div>"},setup:function(){this.labelEl=this.el.querySelector("label"),gform.types[this.type].setLabel.call(this),this.infoEl=this.el.querySelector(".gform-info")},setLabel:function(){gform.toggleClass(this.labelEl,"required",this.required),!1!==this.label&&void 0!==this.labelEl&&null!==this.labelEl&&(this.labelEl.innerHTML=gform.renderString((this.format||{title:null}).title||this.item.title||this.item.label||this.label,this)+this.suffix)},create:function(){var e=document.createElement("span");return e.setAttribute("id","el_"+this.id),gform.addClass(e,gform.columnClasses[this.columns]),gform.addClass(e,gform.offsetClasses[this.offset]),gform.toggleClass(e,"gform_isArray",!!this.array),e.innerHTML=this.render(),e},render:function(){return gform.render(this.type,this).split('value=""').join('value="'+_.escape(this.value)+'"')},destroy:function(){this.el.removeEventListener("change",this.onchangeEvent),this.el.removeEventListener("input",this.onchangeEvent)},initialize:function(){this.onchangeEvent=function(e){if(this.value=this.get(),null!=this.el.querySelector(".count")){var t=(this.value+"").length;this.limit>1&&(t+="/"+this.limit),this.el.querySelector(".count").innerHTML=t}gform.types[this.type].setup.call(this),this.parent.trigger(["change"],this,{input:this.value}),e&&this.parent.trigger(["input"],this,{input:this.value})}.bind(this),this.input=this.input||!1,this.el.addEventListener("input",this.onchangeEvent.bind(null,!0)),this.el.addEventListener("change",this.onchangeEvent.bind(null,!1)),gform.types[this.type].setup.call(this)},update:function(e,t){var i=this.el;void 0===e||void 0===e.options&&void 0===e.max&&void 0===e.action||void 0===this.mapOptions||(delete this.mapOptions,this.item=_.defaults({},e,this.item),this.options=_.extend([],this.item.options),this.max=this.item.max,this.min=this.item.min,this.path=this.item.path,this.action=this.item.action),"object"==typeof e&&(_.extend(this,e),this.item=_.extend(this.item,e)),this.destroy(),this.el=gform.types[this.type].create.call(this),i.parentNode.replaceChild(this.el,i),gform.types[this.type].initialize.call(this),gform.types[this.type].show.call(this,this.visible),gform.types[this.type].edit.call(this,this.editable),t||this.parent.trigger(["change"],this)},get:function(){return this.el.querySelector('input[name="'+this.name+'"]').value},set:function(e){this.el.querySelector('input[name="'+this.name+'"]').value=e},toString:function(e,t){return t?this.value:"<dt>"+this.label+"</dt> <dd>"+(this.value||'<span class="text-muted">(empty)</span>')+"</dd><hr>"},display:function(){return void 0!==this.value&&""!==this.value?this.value:"(empty)"},satisfied:function(e){return e=e||this.value,_.isArray(e)?!!e.length:null!=e&&""!==e&&!("number"==typeof e&&isNaN(e))},edit:function(e){this.editable=e,this.el.querySelector('[name="'+this.name+'"]').disabled=!e},show:function(e){this.el.style.display=e?"block":"none"},find:function(){return this},focus:function(e){window.setTimeout(function(){if(null!==this.el.querySelector('input[name="'+this.name+'"]')&&"function"==typeof this.el.querySelector('input[name="'+this.name+'"]').focus){this.el.querySelector('input[name="'+this.name+'"]').focus();var e=this.value;this.set(""),this.set(e)}}.bind(this),e||0)}},bool:{base:"bool",setup:function(){this.labelEl=this.el.querySelector("label"),gform.types[this.type].setLabel.call(this),this.infoEl=this.el.querySelector(".gform-info")},display:function(){return(_.find(this.options,{value:this.value})||{label:""}).label||this.value},defaults:{options:[!1,!0],format:{value:function(e){return e.value}}},render:function(){return this.strict||0!=this.options[0]||1!=this.options[1]||(this.value=!!this.value),void 0===this.mapOptions&&(this.mapOptions=new gform.mapOptions(this,this.value,0,this.owner.collections),this.mapOptions.on("change",function(){this.options=this.mapOptions.getoptions(),void 0===this.options[0].value&&(this.options[0].value=!1,this.options[0].selected=0==this.value),void 0===this.options[1].value&&(this.options[1].value=!0,this.options[1].selected=1==this.value),this.update()}.bind(this))),this.options=this.mapOptions.getoptions(),void 0===this.options[0].value&&(this.options[0].value=!1,this.options[0].selected=0==this.value),(void 0===this.options[1].value||""==this.options[0].value&&""==this.options[1].value)&&(this.options[1].value=!0,this.options[1].selected=1==this.value),gform.render(this.type,this)},setLabel:function(){var e=gform.renderString((this.format||{title:null}).title||this.item.title||this.item.label||this.label,this);this.required&&(e+=this.requiredText+this.suffix);var t=this.el.querySelector("label[for="+this.name+"]");null!==t&&(t.innerHTML=e)},initialize:function(){this.onchangeEvent=function(e){this.value=this.get(),(_.find(this.options,{selected:!0})||{selected:null}).selected=!1,(_.find(this.options,{value:this.value})||this.options[0]||{value:""}).selected=!0,gform.types[this.type].setup.call(this),this.parent.trigger(e?"change":"input",this,{input:this.value})}.bind(this),this.el.addEventListener("input",this.onchangeEvent.bind(null,!0)),this.el.addEventListener("change",this.onchangeEvent.bind(null,!1)),gform.types[this.type].setup.call(this)},set:function(e){this.el.querySelector('input[name="'+this.name+'"]').checked=e==this.options[1].value},edit:function(e){this.editable=e,this.el.querySelector('[name="'+this.name+'"]').disabled=!e},show:function(e){this.el.style.display=e?"block":"none"},get:function(){return this.options[this.el.querySelector('input[name="'+this.name+'"]').checked?1:0].value},satisfied:function(e){return(e=e||this.value)==this.options[1].value},toString:function(e,t){return t?this.value:"<dt>"+(this.label||this.name)+"</dt> <dd>"+(this.display||'<span class="text-muted">(empty)</span>')+"</dd><hr>"}},collection:{base:"collection",defaults:{format:{label:"{{{label}}}",value:function(e){return"undefined"!==e.value?e.value:(e.label||e.index).toLowerCase().split(" ").join("_")}}},toString:function(e,t){return t?this.multiple?this.value.length?_.reduce(this.value,function(e,t){var i=_.find(this.list,{value:t});return e.push(i.label),e}.bind(this),[])+"<hr>":"":(_.find(this.list,{value:this.value})||{label:""}).label:this.multiple?this.value.length?_.reduce(this.value,function(e,t){var i=_.find(this.list,{value:t});return void 0!==i&&(e+="<dd>"+i.label+"</dd>"),e}.bind(this),"<dt>"+this.label+"</dt> ")+"<hr>":"<dt>"+this.label+'</dt> <dd><span class="text-muted">(no selection)</span></dd><hr>':"<dt>"+this.label+"</dt> <dd>"+((_.find(this.list,{value:this.value})||{label:""}).label||'<span class="text-muted">(no selection)</span>')+"</dd><hr>"},display:function(){return this.multiple?this.value.length?"<ul>"+_.reduce(this.value,function(e,t){var i=_.find(this.list,{value:t});return void 0!==i&&(e+="<li>"+i.label+"</li>"),e}.bind(this),"")+"</ul>":"(no selection)":(_.find(this.list,{value:this.value})||{label:""}).label||"(no selection)"},render:function(){(void 0===this.mapOptions&&(this.mapOptions=new gform.mapOptions(this,this.value,0,this.owner.collections),this.mapOptions.on("change",function(){this.options=this.mapOptions.getobject(),this.list=this.mapOptions.getoptions(),this.mapOptions.waiting||(this.multiple?(_.isArray(this.value)||(this.value=[this.value]),_.each(this.value,function(e){(_.find(this.list,{value:e})||{selected:null}).selected=!0}.bind(this))):((_.find(this.list,{selected:!0})||{selected:null}).selected=!1,(_.find(this.list,{value:this.value})||{value:""}).selected=!0)),this.update()}.bind(this)),this.mapOptions.on("collection",(function(e){e.field.field.owner.trigger("collection",e.field.field)}))),this.options=this.mapOptions.getobject(),this.list=this.mapOptions.getoptions(),this.mapOptions.waiting)||(this.multiple?(_.isArray(this.value)||(this.value=[this.value]),(_.find(this.list,{selected:!0})||{selected:null}).selected=!1,_.each(this.value,function(e){(_.find(this.list,{value:e})||{selected:null}).selected=!0}.bind(this))):(void 0===_.find(this.list,{value:this.value})&&this.other&&(this.value="other"),this.other&&void 0===_.find(this.list,{value:"other"})&&this.options.push({label:"Other",value:"other"}),(_.find(this.list,{selected:!0})||{selected:null}).selected=!1,(_.find(this.list,{value:this.value})||{value:""}).selected=!0));return gform.render(this.type,this)},setup:function(){if(this.multiple&&"undefinded"!=typeof this.limit&&(this.get().length>=this.limit?(this.maxSelected=!0,_.each(this.el.querySelector("select").options,(function(e){e.disabled=!e.selected}))):this.maxSelected&&(this.maxSelected=!1,_.each(this.el.querySelector("select").options,(function(e){e.disabled=!1}))),null!=this.el.querySelector(".count"))){var e=this.get().length;this.limit>1&&(e+="/"+this.limit),this.el.querySelector(".count").innerHTML=e}this.labelEl=this.el.querySelector("label"),gform.types[this.type].setLabel.call(this),this.infoEl=this.el.querySelector(".gform-info")},initialize:function(){this.el.addEventListener("change",function(){if(this.value=this.get(),this.multiple?(_.isArray(this.value)||(this.value=[this.value]),_.each(this.value,function(e){(_.find(this.list,{value:e})||{selected:null}).selected=!0}.bind(this))):((_.find(this.list,{selected:!0})||{selected:null}).selected=!1,(_.find(this.list,{value:this.value})||{value:""}).selected=!0),null!=this.el.querySelector(".count")){var e=this.value.length;this.limit>1&&(e+="/"+this.limit),this.el.querySelector(".count").innerHTML=e}gform.types[this.type].setup.call(this),this.parent.trigger(["change","input"],this,{input:this.value})}.bind(this)),gform.types[this.type].set.call(this,this.value),gform.types[this.type].setup.call(this)},get:function(){var e=this.el.querySelector("select").value;if(search=_.find(this.list,{i:parseInt(e,10)}),e="undefined"==typeof search?this.other?"other":null:search.value,this.multiple){var t=this;e=_.transform(this.el.querySelector("select").options,(function(e,i){if(i.selected){var s=_.find(t.list,{i:parseInt(i.value)});void 0!==s&&e.push(s.value)}}),[])}return e},set:function(e){if(this.multiple){if(_.isArray(e)||(e=[e]),"undefinded"!=typeof this.limit&&e.length>this.limit)return!0;_.each(this.el.querySelector("select").options,function(t){var i=_.find(this.list,{i:parseInt(t.value)});t.selected=void 0!==i&&e.indexOf(i.value)>=0}.bind(this))}else{var t=_.find(this.list,{value:e});this.el.querySelector("select").value=void 0!==t?t.i:null}"function"==typeof gform.types[this.type].setup&&gform.types[this.type].setup.call(this)},focus:function(){var e=this.name;this.multiple&&(e+="[]"),this.el.querySelector('[name="'+e+'"]').focus()},edit:function(e){this.editable=e;var t=this.name;this.multiple&&(t+="[]"),void 0!==this.mapOptions&&this.mapOptions.waiting,this.el.querySelector('[name="'+t+'"]').disabled=!this.editable},show:function(e){this.el.style.display=e?"block":"none"}},section:{base:"section",filter:function(e,t){return gform.filter.call(this,e,t)},setLabel:function(){var e=gform.renderString(this.item.label||this.label,this);this.required&&(e+=this.requiredText+this.suffix);var t=this.el.querySelector("fieldset#"+this.id+">legend,fieldset#"+this.id+">label");null!==t&&(t.innerHTML=e)},create:function(){var e=gform.create(this.render());return gform.addClass(e,gform.columnClasses[this.columns]),gform.addClass(e,gform.offsetClasses[this.offset]),gform.toggleClass(e,"gform_isArray",!!this.array),e},initialize:function(){this.rows=[],this.initialValue=this.value,Object.defineProperty(this,"value",{get:function(){return this.get()},enumerable:!0}),gform.types[this.type].setLabel.call(this)},render:function(){return this.section?gform.render(this.owner.options.sections+"_fieldset",this):gform.render("_fieldset",this)},update:function(e,t){"object"==typeof e&&_.extend(this.item,e);var i=this.el;this.destroy(),this.el=gform.types[this.type].create.call(this),i.parentNode.replaceChild(this.el,i),gform.types[this.type].initialize.call(this),gform.types[this.type].show.call(this,this.visible),gform.types[this.type].edit.call(this,this.editable),this.container=this.el.querySelector("fieldset")||this.el||null,this.reflow(),t||this.parent.trigger(["change"],this)},get:function(e){return void 0!==e?gform.toJSON.call(this,e):_.selectPath(gform.toJSON.call(this),this.map)},toString:function(e,t){return t?gform.toString.call(this,e,t):gform.m('<h4>{{#label}}{{{label}}}{{/label}}</h4><hr><dl style="margin-left:10px">{{{value}}}</dl>',{label:this.label,value:gform.toString.call(this,e)})},display:function(){return'<div class="list-group-item ">'+this.toString()+"</div>"},set:function(e){return null==e||""==e?(gform.each.call(this,(function(e){e.set("")})),this.update({},!0)):_.each(e,function(e,t){var i=this.find(t);if(i.array&&_.isArray(e)){var s=this.filter({array:{ref:i.array.ref}},1);s.length>1&&_.each(s.slice(1),(function(e){var t=_.findIndex(e.parent.fields,{id:e.id});e.parent.fields.splice(t,1)}));var l=function(e,t,i){gform.toggleClass(i.querySelector(e),"hidden",t)};_.isArray(e)&&i.set(e[0]);var n={};n[i.name]=e,gform.inflate.call(this.owner,n,i,_.findIndex(i.parent.fields,{id:i.id}),i.parent.fields);var o=this.filter({array:{ref:i.array.ref}},1).length;_.each(i.operator.container.querySelectorAll(".gform_isArray"),l.bind(null,'[data-ref="'+i.array.ref+'"] .gform-add',o>=(i.array.max||5))),_.each(i.operator.container.querySelectorAll(".gform_isArray"),l.bind(null,'[data-ref="'+i.array.ref+'"] .gform-minus',!(o>(i.array.min||1)))),i.operator.reflow()}else void 0!==i&&i.set(e)}.bind(this)),this.render(),!0},find:function(e){return gform.find.call(this,e)},reflow:function(){gform.reflow.call(this)},focus:function(){void 0!==this.fields&&this.fields.length&&gform.types[this.fields[0].type].focus.call(this.fields[0])},satisfied:function(e){return null!=(e=e||this.get())&&""!==e&&!("object"==typeof e&&_.isEmpty(e))},trigger:function(e,t,i){"string"==typeof e&&(e=[e]);var s=_.extend([],e);_.each(e,function(e){"-1"==e.indexOf(":")&&s.unshift(e+":"+this.name)}.bind(this)),this.parent.trigger(_.uniq(s),t,i)},show:function(e){if(this.owner.options.sections&&this.section)return!0;this.el.style.display=e?"block":"none"}},button:{base:"button",setLabel:function(){var e=gform.renderString((this.format||{title:null}).title||this.item.title||this.item.label||this.label,this);this.required&&(e+=this.requiredText+this.suffix);var t=this.el;null!==t&&(t.innerHTML=e)},toString:function(){return""},defaults:{parse:!1,columns:2,target:".gform-footer",map:!1},create:function(){var e=gform.create(this.render());return e.setAttribute("id","el_"+this.id),e},initialize:function(){this.action=this.action||(this.label||"").toLowerCase().split(" ").join("_"),this.onclickEvent=function(){this.editable&&this.parent.trigger(this.action,this)}.bind(this),this.el.addEventListener("click",this.onclickEvent),gform.types[this.type].setLabel.call(this)},render:function(){return gform.render("button",this)},satisfied:function(e){return this.editable&&this.visible},update:function(e,t){"object"==typeof e&&_.extend(this,this.item,e);var i=this.el;this.destroy(),this.el=gform.types[this.type].create.call(this),i.parentNode.replaceChild(this.el,i),gform.types[this.type].initialize.call(this),gform.types[this.type].show.call(this,this.visible),gform.types[this.type].edit.call(this,this.editable)},destroy:function(){this.el.removeEventListener("click",this.onclickEvent)},get:function(e){return null},set:function(e){},edit:function(e){this.editable=e,this.el.disabled=!e,gform.toggleClass(this.el,"disabled",!e)},show:function(e){this.el.style.display=e?"block":"none"},focus:function(){this.el.focus()}}},gform.types.text=gform.types.password=gform.types.color=gform.types.input,gform.types.number=_.extend({},gform.types.input,{get:function(){return parseFloat(this.el.querySelector('input[name="'+this.name+'"]').value,10)},render:function(){return gform.render(this.type,this).split('value=""').join('value="'+this.value+'"')}}),gform.types.hidden=_.extend({},gform.types.input,{defaults:{columns:!1},toString:function(e,t){return t?this.value:""}}),gform.types.output=_.extend({},gform.types.input,{focus:function(){},toString:function(e,t){return t?this.value:""},display:function(){return gform.renderString((this.format||{}).value||"{{{value}}}",_.pick(this,"value","name","id","inline","valid","map","path","parsable","reportable","visible","parent","owner","data","editable","parent","fillable","array","columns","offset","ischild","pre","post"))},render:function(){return gform.render(this.type,this)},get:function(){return this.value},set:function(e){this.value=e,this.el.querySelector("output").innerHTML=this.display}}),gform.types.email=_.extend({},gform.types.input,{defaults:{validate:[{type:"valid_email"}]}}),gform.types.textarea=_.extend({},gform.types.input,{set:function(e){this.el.querySelector('textarea[name="'+this.name+'"]').value=e},get:function(){return this.el.querySelector('textarea[name="'+this.name+'"]').value},render:function(){return gform.render(this.type,this).split("></textarea>").join(">"+_.escape(this.value)+"</textarea>")},focus:function(e){window.setTimeout(function(){if(null!==this.el.querySelector('textarea[name="'+this.name+'"]')&&"function"==typeof this.el.querySelector('textarea[name="'+this.name+'"]').focus){this.el.querySelector('textarea[name="'+this.name+'"]').focus();var e=this.value;this.set(""),this.set(e)}}.bind(this),e||0)}}),gform.types.switch=gform.types.checkbox=_.extend({},gform.types.input,gform.types.bool),gform.types.select=_.extend({},gform.types.input,gform.types.collection,{render:function(){if(void 0===this.mapOptions&&(this.mapOptions=new gform.mapOptions(this,this.value,0,this.owner.collections),this.mapOptions.on("change",function(){if(this.options=this.mapOptions.getobject(),this.list=this.mapOptions.getoptions(),this.other&&void 0===_.find(this.list,{value:"other"})&&(this.options.push({label:"Other",value:"other"}),this.list.push({label:"Other",value:"other"})),"string"==typeof this.placeholder&&(this.options.unshift({label:this.placeholder,value:"",i:-1,editable:!1,visible:!1,selected:!0}),this.list.unshift({label:this.placeholder,value:"",i:-1,editable:!1,visible:!1,selected:!0})),!this.mapOptions.waiting)if(this.multiple)_.isArray(this.value)||(this.value=[this.value]),_.each(this.value,function(e){(_.find(this.list,{value:e})||{selected:null}).selected=!0}.bind(this));else{(_.find(this.list,{selected:!0})||{selected:null}).selected=!1;var e=_.find(this.list,{value:this.value});void 0===e?"string"==typeof this.placeholder?this.value="":(this.value=(this.list[0]||{value:""}).value,this.list.length&&(this.list[0].selected=!0)):e.selected=!0}this.update()}.bind(this)),this.mapOptions.on("collection",(function(e){e.field.field.owner.trigger("collection",e.field.field)}))),this.options=this.mapOptions.getobject(),this.list=this.mapOptions.getoptions(),"string"==typeof this.placeholder&&(this.options.unshift({label:this.placeholder,value:"",i:-1,editable:!1,visible:!1,selected:!0}),this.list.unshift({label:this.placeholder,value:"",i:-1,editable:!1,visible:!1,selected:!0})),!this.mapOptions.waiting)if(this.multiple)_.isArray(this.value)||(this.value=[this.value]),(_.find(this.list,{selected:!0})||{selected:null}).selected=!1,_.each(this.value,function(e){(_.find(this.list,{value:e})||{selected:null}).selected=!0}.bind(this));else{this.other&&void 0===_.find(this.list,{value:"other"})&&(this.options.push({label:"Other",value:"other"}),this.list.push({label:"Other",value:"other"})),(_.find(this.list,{selected:!0})||{selected:null}).selected=!1;var e=_.find(this.list,{value:this.value});void 0===e?this.other?this.value="other":"string"==typeof this.placeholder?this.value="":(this.value=(this.list[0]||{value:""}).value,this.list.length&&(this.list[0].selected=!0)):e.selected=!0}return gform.render("select",this)}}),gform.types.range=_.extend({},gform.types.input,gform.types.collection,{get:function(){return(this.el.querySelector("[type=range]")||{value:""}).value},set:function(e){this.el.querySelector("[type=range]").value=e}}),gform.types.radio=_.extend({},gform.types.input,gform.types.collection,{setup:function(){if(this.multiple&&"undefinded"!=typeof this.limit&&(this.get().length>=this.limit?(this.maxSelected=!0,_.each(this.el.querySelectorAll("[type=checkbox]"),(function(e){e.disabled=!e.checked}))):this.maxSelected&&(this.maxSelected=!1,_.each(this.el.querySelectorAll("[type=checkbox]"),(function(e){e.disabled=!1}))),null!=this.el.querySelector(".count"))){var e=this.get().length;this.limit>1&&(e+="/"+this.limit),this.el.querySelector(".count").innerHTML=e}this.labelEl=this.el.querySelector("label"),gform.types[this.type].setLabel.call(this),this.infoEl=this.el.querySelector(".gform-info")},render:function(){(void 0!==this.item.size&&(this.size=Math.floor((gform.columns||12)/this.item.size)),void 0===this.mapOptions&&(this.mapOptions=new gform.mapOptions(this,this.value,0,this.owner.collections),this.mapOptions.on("change",function(){this.options=this.mapOptions.getobject(),this.list=this.mapOptions.getoptions(),this.multiple?(_.isArray(this.value)||(this.value=[this.value]),_.each(this.value,function(e){(_.find(this.list,{value:e})||{selected:null}).selected=!0}.bind(this))):((_.find(this.list,{selected:!0})||{selected:null}).selected=!1,(_.find(this.list,{value:this.value})||{value:""}).selected=!0),this.update()}.bind(this)),this.mapOptions.on("collection",(function(e){e.field.field.owner.trigger("collection",e.field.field)}))),this.options=this.mapOptions.getobject(),this.list=this.mapOptions.getoptions(),this.mapOptions.waiting)||(this.multiple?(_.isArray(this.value)||(this.value=[this.value]),(_.find(this.list,{selected:!0})||{selected:null}).selected=!1,_.each(this.value,function(e){(_.find(this.list,{value:e})||{selected:null}).selected=!0}.bind(this))):(void 0===_.find(this.list,{value:this.value})&&this.other&&(this.value="other"),this.other&&void 0===_.find(this.list,{value:"other"})&&this.options.push({label:"Other",value:"other"}),(_.find(this.list,{selected:!0})||{selected:null}).selected=!1,(_.find(this.list,{value:this.value})||{value:""}).selected=!0));return gform.render(this.type,this)},get:function(){if(this.multiple){var e=this;return _.transform(this.el.querySelectorAll('[type="checkbox"]:checked'),(function(t,i){t.push(_.find(e.list,{i:parseInt(i.value)}).value).bind}),[])}return(_.find(this.list,{i:parseInt((this.el.querySelector('[type="radio"]:checked')||{value:null}).value)})||{value:""}).value},set:function(e){if(this.multiple){if(_.isArray(e)||(e=[e]),"undefinded"!=typeof this.limit&&e.length>this.limit)return!0;_.each(this.el.querySelectorAll("[type=checkbox]"),function(t){var i=_.find(this.list,{i:parseInt(t.value)});t.selected=void 0!==i&&e.indexOf(i.value)>=0,t.checked=void 0!==i&&e.indexOf(i.value)>=0}.bind(this))}else{var t,i;if((this.el.querySelector('[value="'+(_.find(this.list,{value:this.value})||{i:""}).i+'"]')||{}).checked=!1,void 0!==(t=_.find(this.list,{value:e})))null!==(i=this.el.querySelector('[value="'+t.i+'"]'))&&(e=e,i.checked="checked");else if(e=this.default||null,void 0===(t=_.find(this.list,{value:e}))&&void 0!==this.defaultIndex&&(t=_.find(this.list,{index:""+this.defaultIndex})),void 0!==t)null!==(i=this.el.querySelector('[value="'+t.i+'"]'))&&(i.checked="checked")}"function"==typeof gform.types[this.type].setup&&gform.types[this.type].setup.call(this)},edit:function(e){this.editable=e,_.each(this.el.querySelectorAll("input"),(function(t){t.disabled=!e}))},focus:function(){this.el.querySelector('[type="radio"],[type="checkbox"]').focus()}}),gform.types.scale=_.extend({},gform.types.radio),gform.types.checkboxes=_.extend({},gform.types.radio,{multiple:!0}),gform.types._grid_row=_.extend({},gform.types.hidden,{toString:function(e,t){return t?this.multiple?this.value.length?_.reduce(this.value,function(e,t){var i=_.find(this.list,{value:t});return e.push(i.label),e}.bind(this),[])+"<hr>":"":(_.find(this.list,{value:this.value})||{label:""}).label:this.multiple?this.value.length?_.reduce(this.value,function(e,t){var i=_.find(this.list,{value:t});return void 0!==i&&(e+="<span>"+i.label+"</span>"),e}.bind(this),'<tr><td style="width:20%">'+this.label+"</td><td>")+"</td><tr>":'<tr><td style="width:20%">'+this.label+'</td> <td><span class="text-muted">(no selection)</span></td></tr>':'<tr><td style="width:20%">'+this.label+"</td> <td>"+((_.find(this.parent.list,{value:this.parent.value[this.name]})||{label:""}).label||'<span class="text-muted">(no selection)</span>')+"</td></tr>"}}),gform.types.grid=_.extend({},gform.types.input,gform.types.section,gform.types.collection,{toString:function(e,t){return t?gform.toString.call(this,e,t):"<dt>"+this.label+'</dt><dd><table class="table table-bordered">'+gform.toString.call(this,e)+"</table></dd><hr>"},render:function(){return void 0===this.mapOptions&&(this.mapOptions=new gform.mapOptions(this,this.value,0,this.owner.collections),this.mapOptions.on("change",function(){this.options=this.mapOptions.getobject(),this.list=this.mapOptions.getoptions(),this.update()}.bind(this))),this.options=this.mapOptions.getobject(),this.list=this.mapOptions.getoptions(),this.fields=_.map(this.fields,(function(e){return _.assignIn({name:(gform.renderString(e.label)||"").toLowerCase().split(" ").join("_"),id:gform.getUID(),label:e.id||e.name},e)})),gform.render(this.type,this)},setup:function(){this.multiple&&"undefinded"!=typeof this.limit?_.each(this.fields,function(e){(this.value[e.name]||[]).length>=this.limit?(e.maxSelected=!0,_.each(this.el.querySelectorAll('[type=checkbox][name="'+e.id+'"]'),(function(e){e.disabled=!e.checked}))):e.maxSelected&&(e.maxSelected=!1,_.each(this.el.querySelectorAll('[type=checkbox][name="'+e.id+'"]'),(function(e){e.disabled=!1})))}.bind(this)):_.each(this.fields,function(e){var t=this.el.querySelector('[name="'+e.id+'"][value="'+(this.value[e.name]||"")+'"]');null!==t&&(t.checked="checked")}.bind(this)),this.labelEl=this.el.querySelector("label"),gform.types[this.type].setLabel.call(this),this.infoEl=this.el.querySelector(".gform-info")},initialize:function(){this.el.addEventListener("change",function(){this.value=this.get(),gform.types[this.type].setup.call(this),this.parent.trigger(["change","input"],this,{input:this.value})}.bind(this)),gform.types[this.type].setup.call(this),this.rows=[],this.fields=_.map(this.fields,(function(e){return e.type="_grid_row",e})),gform.types[this.type].setLabel.call(this)},get:function(){return this.multiple?_.transform(this.fields,function(e,t){e[t.name]=_.transform(this.el.querySelectorAll('[type="checkbox"][name="'+t.id+'"]:checked'),(function(e,t){e.push(t.value)}),[])}.bind(this),{}):_.transform(this.fields,function(e,t){e[t.name]=(this.el.querySelector('[type="radio"][name="'+t.id+'"]:checked')||{value:""}).value}.bind(this),{})},set:function(e){this.multiple?_.each(this.fields,function(e,t){if("undefinded"!=typeof this.limit&&null!=e&&e.length>this.limit)return!0;_.each(this.el.querySelectorAll('[name="'+t.id+'"][type=checkbox]'),function(e,t){t.checked=e.indexOf(t.value)>=0}.bind(this,e[t.name]))}.bind(this,e)):_.each(this.fields,function(t){var i=this.el.querySelector('[name="'+t.id+'"][value="'+e[t.name]+'"]');null!==i&&(i.checked="checked")}.bind(this)),this.value=e,gform.types.grid.setup.call(this)},focus:function(){this.el.querySelector('[name="'+this.fields[0].id+'"]').focus()}}),gform.types.fieldset=_.extend({},gform.types.input,gform.types.section,{}),gform.types.template=_.extend({},gform.types.input,gform.types.section,{row:function(){return gform.render("template",this)},rowSelector:".gform-template_row",array:{max:5,min:1,duplicate:{enable:!1},remove:{enable:!0},append:{enable:!0}},initialize:function(){this.rows=[],this.initialValue=this.value,this.owner.on("appended",function(e,t){e==t.field.id&&t.field.el.click()}.bind(null,this.id)),this.owner.on("close",function(e,t){void 0!==t.field&&e==t.field.id&&(t.field.modal("hide"),t.field.modalEl.querySelector(".gform-modal_body").removeChild(t.field.container),t.field.container.removeEventListener("click",t.form.listener),t.field.value=t.field.get(),t.field.update(),t.form.trigger("done",this))}.bind(null,this.id)),Object.defineProperty(this,"value",{get:function(){return this.get()}}),gform.types[this.type].setLabel.call(this)},display:function(){return gform.renderString((this.format||{template:"{{{value}}}"}).display,_.pick(this,"value","label","name","id","inline","valid","map","path","parsable","reportable","visible","parent","editable","parent","fillable","array","columns","offset","ischild","pre","post"))},render:function(){return gform.m(gform.render("template_item",this),this)},edit:function(e){var t=e.target.classList.value.indexOf("gform-")<0&&e.target.parentElement.classList.value.indexOf("gform-")>=0?e.target.parentElement:e.target;t.classList.contains("gform-minus")||t.classList.contains("gform-add")||!(null==this.el.querySelector(".gform-edit")||this.el.querySelector(".gform-edit")&&t.classList.contains("gform-edit")||this.el.querySelector(".gform-edit").contains(t))||(e.preventDefault(),this.modalEl=gform.create(gform.render("modal_container",{body:'<div class="gform-modal_body"></div>',footer:gform.render("child_modal_footer"),legend:this.label,name:"preview"})),this.container.addEventListener("click",this.owner.listener),this.modalEl.querySelector(".gform-modal_body").appendChild(this.container),this.modal=gform.prototype.modal.bind(this),this.modal(),this.find({visible:!0}).focus(this.owner.modalDelay),this.modalEl.querySelector(".done").addEventListener("click",function(e){this.owner.trigger("close",this)}.bind(this)),this.modalEl.querySelector(".gform-footer .gform-minus").addEventListener("click",function(){e.stopPropagation(),e.preventDefault(),this.modal("hide"),this.modalEl.querySelector(".gform-modal_body").removeChild(this.container),this.container.removeEventListener("click",this.owner.listener),gform.removeField.call(this.owner,this)}.bind(this)))},create:function(){var e=gform.create(this.render());return gform.toggleClass(e,"gform_isArray",!!this.array),this.container=gform.create("<fieldset></fieldset>"),e.addEventListener("click",gform.types.template.edit.bind(this)),e},update:function(e,t){"object"==typeof e&&_.extend(this.item,e),gform.types[this.type].setLabel.call(this),this.el.querySelector(".gform-template_container").innerHTML=gform.types[this.type].display.call(this),t||this.parent.trigger(["change"],this)}}),gform.types.table=_.extend({},gform.types.input,gform.types.section,{row:function(){return this.labels=_.filter(this.fields,(function(e){return!e.sibling})),gform.render("table",this)},toString:function(e,t){if(t)return gform.toString.call(this,e,t);if(this.sibling)return"";var i=_.reduce(this.parent.filter(this.name),(function(e,t){var i=document.createElement("tr");return t.render(i),e+=i.outerHTML}),"");return gform.m('<h4>{{#label}}{{{label}}}{{/label}}</h4><dl style="margin-left:10px"><table class="table"><thead><tr>{{#field.fields}}<th>{{{label}}}</th>{{/field.fields}}</tr></thead><tbody>{{{value}}}</tbody></table></dl>',{label:this.label,value:i,field:this})},rowSelector:"tbody",array:{max:5,min:1,duplicate:{enable:!1},remove:{enable:!1},append:{enable:!0},sortable:{enable:!0}},initialize:function(){this.rows=[],this.initialValue=this.value,this.owner.on("appended",function(e,t){e==t.field.id&&t.field.el.click()}.bind(null,this.id)),this.owner.on("close",function(e,t){void 0!==t.field&&e==t.field.id&&(t.field.owner.valid=!0,t.field.owner.validate.call(t.field,!0),t.field.owner.valid&&(t.field.modal("hide"),t.field.modalEl.querySelector(".gform-modal_body").removeChild(t.field.container),t.field.container.removeEventListener("click",t.form.listener),t.field.value=t.field.get(),t.field.update(),t.field.array.sortable.enable&&"undefined"!=typeof $&&void 0!==$.bootstrapSortable&&$.bootstrapSortable({applyLast:!0}),t.form.trigger("done",this)))}.bind(null,this.id)),Object.defineProperty(this,"value",{get:function(){return this.get()}}),gform.types[this.type].setLabel.call(this)},render:function(e){(e=e||this.el).innerHTML="",_.each(this.fields,function(t){var i="";void 0!==(this.value||{})[t.name]&&""!==(this.value||{})[t.name]?i=(this.value||{})[t.name]:void 0!==t.value&&""!==t.value&&(i=t.value);var s=document.createTextNode(i);if("string"==typeof t.display?s=gform.create(t.display):"function"==typeof t.display&&(s=gform.create(t.display.call(this))),t.sibling)e.querySelector("#"+t.array.ref).appendChild(s);else{var l=document.createElement("td");void 0!==t.array&&l.setAttribute("id",t.array.ref),l.appendChild(s),e.appendChild(l)}}.bind(this))},display:function(){return this.toString()},edit:function(e){e.target.classList.contains("gform-minus")||e.target.classList.contains("gform-add")||(e.preventDefault(),this.modalEl=gform.create(gform.render("modal_container",{body:'<div class="gform-modal_body"></div>',footer:gform.render("child_modal_footer"),legend:this.label,name:"preview"})),this.container.addEventListener("click",this.owner.listener),this.modalEl.querySelector(".gform-modal_body").appendChild(this.container),this.modal=gform.prototype.modal.bind(this),this.modal(),this.find({visible:!0}).focus(this.owner.modalDelay),this.modalEl.querySelector(".done").addEventListener("click",function(e){this.owner.trigger("close",this)}.bind(this)),this.modalEl.querySelector(".gform-footer .gform-minus").addEventListener("click",function(){e.stopPropagation(),e.preventDefault(),this.modal("hide"),this.modalEl.querySelector(".gform-modal_body").removeChild(this.container),this.container.removeEventListener("click",this.owner.listener),gform.removeField.call(this.owner,this)}.bind(this)))},create:function(){var e=document.createElement("tr");return gform.addClass(e,"gform-edit"),this.render(e),e.setAttribute("id","el_"+this.id),gform.toggleClass(e,"gform_isArray",!!this.array),this.container=gform.create("<fieldset></fieldset>"),e.removeEventListener("click",gform.types.table.edit.bind(this)),e.addEventListener("click",gform.types.table.edit.bind(this)),e},update:function(e,t){"object"==typeof e&&_.extend(this.item,e),gform.types[this.type].setLabel.call(this),this.render(),t||this.parent.trigger(["change"],this)}}),gform.types.custom_radio=_.extend({},gform.types.input,gform.types.collection,{set:function(e){var t=this.el.querySelector('[data-value="'+e+'"]');null!==t&&t.click()},defaults:{selectedClass:"btn btn-success",defaultClass:"btn btn-default"},get:function(){return(this.el.querySelector("."+this.selectedClass.split(" ").join("."))||{dataset:{value:""}}).dataset.value},toggle:function(e){var t=this.el.querySelector("."+this.selectedClass.split(" ").join("."));gform.toggleClass(t,this.selectedClass,!1),gform.toggleClass(t,this.defaultClass,!0),gform.toggleClass(e.target,this.defaultClass,!1),gform.toggleClass(e.target,this.selectedClass,!0),this.owner.trigger("change",this),this.owner.trigger("input",this)},initialize:function(){var e=this.el.querySelectorAll("a");for(const t of e)t.removeEventListener("click",gform.types[this.type].toggle.bind(this)),t.addEventListener("click",gform.types[this.type].toggle.bind(this));gform.types[this.type].setLabel.call(this)}});
gform.m=function(t,n,e,o){var i,r=gform.m,s="";function f(t,n){return t=null!=(t=t[(n=n.pop?n:n.split(".")).shift()])?t:"",0 in n?f(t,n):t}n=Array.isArray(n)?n:n?[n]:[],n=o?0 in n?[]:[1]:n;for(i=0;i<n.length;i++){var a,c="",u=0,h="object"==typeof n[i]?n[i]:{};(h=Object.assign({},e,h))[""]={"":n[i]},t.replace(/([\s\S]*?)({{((\/)|(\^)|#)(.*?)}}|$)/g,(function(t,n,e,o,i,d,l){u?c+=u&&!i||1<u?t:n:(s+=n.replace(/{{{(.*?)}}}|{{(!?)(&?)(>?)(.*?)}}/g,(function(t,n,e,o,i,s){return n?f(h,n):o?f(h,s):i?r(f(h,s),h):e?"":new Option(f(h,s)).innerHTML})),a=d),i?--u||(l=f(h,l),/^f/.test(typeof l)?s+=l.call(h,c,(function(t){return r(t,h)})):s+=r(c,l,h,a),c=""):++u}))}return s},gform.render=function(t,n){return gform.renderString(gform.stencils[t||"text"]||gform.stencils.text,_.extend({},gform.stencils,n))},gform.create=function(t){return document.createRange().createContextualFragment(t).firstChild},gform.renderString=function(t,n){return gform.m(t||"",_.extend({math:function(t,n){return math.eval(n(t),_.omit(this,"toString"))},moment:function(t,n){var e=t.split("|"),o=moment(n(e.shift()));return"fromNow"==e[0]?o.fromNow():o.format(e[0])}},this.methods,n))},gform.addClass=function(t,n){void 0!==n&&n.length&&void 0!==t&&t&&(t.className=_.chain(t.className).split(/[\s]+/).union(n.split(" ")).join(" ").value())},gform.hasClass=function(t,n){if(void 0!==n&&n.length&&void 0!==t&&t)return-1!==t.className.indexOf(n)},gform.removeClass=function(t,n){void 0!==n&&n.length&&void 0!==t&&t&&(t.className=_.chain(t.className).split(/[\s]+/).difference(n.split(" ")).join(" ").value())},gform.toggleClass=function(t,n,e){e?gform.addClass(t,n):gform.removeClass(t,n)},gform.ajax=function(t){var n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&(200===n.status?t.success(JSON.parse(n.responseText)):"function"==typeof t.error&&t.error(n.responseText))},n.open(t.verb||"GET",t.path),n.send()},gform.patch=function(t,n,e){return _.isArray(n)||(n=[n]),_.reduce(n,(function(n,e){if("string"!=typeof e.map)return n;var o=_.toPath(e.map);for(t=n;o.length>1;){var i=o.shift();"object"!=typeof t[i]&&(isFinite(o[0])?_.isArray(t[i])||(t[i]=[]):t[i]={}),t=t[i]}i=o.shift();return"delete"==e.action?_.isArray(t)?t.splice(i,1):(delete t[i],t=_.compact(t)):void 0!==e.toJSON?t[i]=e.toJSON:t[i]=e.value,n}),t||{})},_.mixin({selectPath:function(t,n){var e=t;return e="function"==typeof t.toJSON?t.toJSON():_.extend({},e),_.reduce(_.toPath(n),(function(t,n){return"object"==typeof t&&null!==t?t[n]:void 0}),e)}}),gform.rows={add:function(t){var n=gform.getUID();return cRow={},cRow.used=0,cRow.ref=document.createElement("div"),cRow.ref.setAttribute("id",n),cRow.ref.setAttribute("class",this.options.rowClass),cRow.ref.setAttribute("style","margin-bottom:0;"),t.rows[n]=cRow,t.container.appendChild(cRow.ref),cRow},remove:function(){}},gform.eventBus=function(t,n){this.options=t||{owner:"form",item:"field"},this.owner=n||this,this.on=function(t,n,e){if(void 0!==t){var o=t.split(" ");_.each(o,function(t,e){this.handlers[e]=this.handlers[e]||[],"function"==typeof n?(this.handlers[e].push(n),"object"==typeof t&&t.push(n)):"function"==typeof this.owner.methods[n]&&this.handlers[e].push(this.owner.methods[n])}.bind(this,e))}return this.owner}.bind(this),_.isArray(t.handlers)?(this.handlers={},_.each(t.handlers,function(t){null!==t&&"event"in t&&"handler"in t&&this.on(t.event,t.handler)}.bind(this))):this.handlers=_.extend({},t.handlers),_.each(this.handlers,function(t,n,e){"function"==typeof t?e[n]=[t]:"string"==typeof t&&("function"==typeof this[t]?e[n]=[this[t]]:"function"==typeof this.owner[t]?e[n]=[this.owner[t]]:"methods"in this.owner&&"function"==typeof this.owner.methods[t]?e[n]=[this.owner.methods[t]]:"function"==typeof window[t]?e[n]=[window[t]]:e[n]=null)}.bind(this)),this.dispatch=function(t,e,o){(o=o||{})[this.options.owner]=this.owner,void 0!==e&&(o[this.options.item]=e),o.default=!0,o.continue=!0,o.preventDefault=function(){this.default=!1}.bind(o),o.stopPropagation=function(){this.continue=!1}.bind(o);var i=[];return"string"==typeof t?i.push(t):i=i.concat(t),_.each(i,function(t,e){t.event=e;var i=function(e){o.continue&&"function"==typeof e&&e.call(n,t)}.bind(this);_.each(this.handlers[e],i),_.each(this.handlers["*"],i)}.bind(this,o)),o}.bind(this)},gform.collectionManager=function(t){var n=t||{};return this.eventBus=new gform.eventBus({owner:"manager",item:"collection",handlers:{}},this),{add:function(t,e){n[t]=e,this.eventBus.dispatch("change",t)}.bind(this),get:function(t){return void 0===t?n:n[t]},update:function(t,e){void 0!==e&&(n[t]=e),this.eventBus.dispatch(t,n[t]),this.eventBus.dispatch("change",t)}.bind(this),on:this.eventBus.on}},gform.VERSION="0.0.2.0",gform.i=0,gform.getUID=function(){return"f"+gform.i++},gform.about=function(){return _.extend({version:gform.VERSION},gform.THEME,{types:_.keys(gform.types)})};
gform.each=function(i){_.each(this.fields,(function(n){i(n),"fields"in n&&gform.each.call(n,i)}))},gform.reduce=function(i,n,e){n=n||{};return _.reduce(this.filter(e,1),(function(n,f){var t=i(n,f);return"fields"in f&&(t=gform.reduce.call(f,i,t,e)),t}),n),n},gform.reduceShallow=function(i,n,e){n=n||{};return _.reduce(this.filter(e,1),(function(n,e){return i(n,e)}),n),n},gform.find=function(i,n){var e,f;if("string"==typeof i)e=i.split("."),f=_.find(this.fields,{name:e.shift()});else if("number"==typeof i);else if("object"==typeof i)return gform.filter.call(this,i,n)[0]||!1;return void 0!==f?"find"in f?f.name==i||"number"==typeof i?f:f.find(e.join(".")):f:void 0!==this.parent&&"function"==typeof this.parent.find?this.parent.find(i):void 0},gform.findByID=function(i){return gform.filter.call(this,{id:i},10)[0]||!1},gform.filter=function(i,n){var e=[];"string"==typeof i&&(i={name:i});n=n||10;return n--,_.each(this.fields,function(n,f){_.isMatch(f,i)&&e.push(f),n&&"fields"in f&&(e=e.concat(gform.filter.call(f,i,n)))}.bind(null,n)),e};
gform.collections=new gform.collectionManager,gform.instances={},gform.prototype.options={autoFocus:!0,rootpath:"",actions:[{type:"cancel"},{type:"save"}],rowClass:"row",default:{type:"text",suffix:":",requiredText:'<span style="color:red">*</span>',validate:[],valid:!0,parsable:!0,reportable:!0,visible:!0,editable:!0,fillable:!0,array:!1},clear:!0,sections:"",subsections:!1},gform.toJSON=function(e){if("string"==typeof e&&e.length>0){var t=this.find({map:e},_.toPath(e).length);if(!t&&!(t=this.find({name:e},_.toPath(e).length)))return;return t.get()}return gform.reduceShallow.call(this,gform.patch,{},{parsable:!0})},gform.toString=function(e,t){if(t){if("string"==typeof e&&e.length>0)return e=e.split("."),_.find(this.fields,{name:e.shift()}).toString(e.join("."),t);i={};return _.each(this.fields,(function(t){(t.visible||t.reportable)&&(t.array?(i[t.name]=i[t.name]||[],i[t.name].push(t.toString(e,!0))):i[t.name]=t.toString(e,!0))})),i}if("string"==typeof e&&e.length>0)return e=e.split("."),_.find(this.fields,{name:e.shift()}).toString(e.join("."));var i="";return _.each(this.fields,(function(e){e.reportable&&(i+=e.toString())})),i},gform.addConditions=function(e){gform.processConditions.call(e,e.show,(function(e){var t=this.visible!==e;this.visible=e,gform.types[this.type].show.call(this,this.visible),t&&(this.operator.reflow(),this.owner.trigger("change",this))})),gform.processConditions.call(e,e.edit,(function(e){this.editable=e,gform.types[this.type].edit.call(this,this.editable)})),"parse"in e||(e.parse=e.show),gform.processConditions.call(e,e.parse,(function(e){this.parsable=e})),"report"in e||(e.report=e.show),gform.processConditions.call(e,e.report,(function(e){this.reportable=e})),e.required&&gform.processConditions.call(e,e.required,(function(e){this.required!==e&&(this.required=e,gform.types[this.type].setLabel.call(this))}))},gform.mapOptions=function(e,t,i,n,r){r=r||[],e.owner instanceof gform&&(this.field=e),this.collections=n,this.eventBus=new gform.eventBus({owner:"field",item:"option"},this),this.optgroup=_.extend({},e),i=i||0;var o=this.optgroup.format;function a(e){return _.map(e,function(e){if("object"==typeof e&&"optgroup"==e.type)return e.map=new gform.mapOptions(_.extend({format:o},e),t,i,this.collections,r),e.map.on("*",function(e){this.eventBus.dispatch(e.event)}.bind(this)),e.id=gform.getUID(),gform.processConditions.call(this.field,e.edit,function(e,t,i){_.find(this.optgroup.options,{id:e}).editable=t,this.eventBus.dispatch("change")}.bind(this,e.id)),gform.processConditions.call(this.field,e.show,function(e,t,i){_.find(this.optgroup.options,{id:e}).visible=t,this.eventBus.dispatch("change")}.bind(this,e.id)),i+=e.map.getoptions().length,e;var n=_.extend({},e);return n.data=e,"string"!=typeof e&&"number"!=typeof e&&"boolean"!=typeof e||(n.label=n.value=e),n.index=e.index||""+i,void 0!==o&&(n=_.reduce(["label","display","value"],function(e,t){return t in o&&(t in e&&(e.original=e.original||{},e.original[t]=e[t]),e[t]="string"==typeof o[t]?gform.renderString(o[t],e):"function"==typeof o[t]?o[t].call(this,e):e[t]),e}.bind(this),n)),(n.value==t||null!=t&&t.length&&t.indexOf(n.value)>=0)&&(n.selected=!0),i+=1,n.i=i,n}.bind(this))}switch(this.optgroup.options=this.optgroup.options||[],typeof this.optgroup.options){case"string":this.optgroup.path=this.optgroup.path||this.optgroup.options,this.optgroup.options=[];break;case"function":this.optgroup.action=this.optgroup.options,this.optgroup.options=[]}if("max"in this.optgroup&&""!==this.optgroup.max)for(var s=this.optgroup.min||0;s<=this.optgroup.max;s+=this.optgroup.step||1)this.optgroup.options.push(""+s);"function"==typeof this.optgroup.action&&(this.optgroup.options=this.optgroup.options.concat(a.call(this,this.optgroup.action.call(this)))),_.isArray(this.optgroup.options)&&(this.optgroup.options=a.call(this,this.optgroup.options)),_.isString(this.optgroup.path)&&this.optgroup.path&&(this.collections.on(this.optgroup.path,function(e){this.optgroup.options=a.call(this.optgroup.map,e.collection),r.indexOf(e.event)>=0&&delete r[r.indexOf(e.event)],this.eventBus.dispatch("change")}.bind(this)),this.collections.get(this.optgroup.path)&&"waiting"!=this.collections.get(this.optgroup.path)?this.optgroup.options=a.call(this.optgroup.map,this.collections.get(this.optgroup.path)):(-1==r.indexOf(this.optgroup.path)&&r.push(this.optgroup.path),"waiting"!==this.collections.get(this.optgroup.path)&&(this.collections.add(this.optgroup.path,"waiting"),gform.ajax({path:(gform.options.rootpath||"")+this.optgroup.path,success:function(e){this.collections.update(this.optgroup.path,e),r.indexOf(this.optgroup.path)>=0&&delete r[r.indexOf(this.optgroup.path)],this.eventBus.dispatch("collection"),this.eventBus.dispatch("change")}.bind(this)}))));var l={getobject:function(){return _.map(this.optgroup.options,(function(e){return e.visible=!("visible"in e)||e.visible,e.editable=!("editable"in e)||e.editable,"map"in e?(e.options=e.map.getoptions(),{optgroup:{label:e.label||"",visible:e.visible,editable:e.editable,options:e.map.getoptions()}}):e}))}.bind(this),getoptions:function(e){var t=[];return _.each(this.optgroup.options,(function(e){e.visible=!("visible"in e)||e.visible,e.editable=!("editable"in e)||e.editable,"map"in e?t=t.concat(e.map.getoptions()):t.push(e)})),void 0!==e?_.find(t,e):t}.bind(this),on:this.eventBus.on,handlers:this.handlers,optgroup:this.optgroup};return Object.defineProperty(l,"waiting",{get:function(){return _.compact(r).length>0}}),l},gform.layout=function(e){if(0!=e.columns&&e.visible){var t={},i=!1;if("parent"in e&&e.parent.container){var n=e.parent.container;if(e.operator=e.parent,"function"==typeof e.target&&(e.target=e.target.call(e)),"string"==typeof e.target){var r=e.owner.el.querySelector(e.target);null!=r?(t={target:e.target},n=r,e.operator=e.owner):e.owner.options.clear?t.id=e.target:i=!0}e.sibling&&(t.id=e.operator.filter({array:{ref:e.array.ref}},1)[0].row);var o=_.findLast(e.operator.rows,t);if(!(e.sibling&&"id"in t&&void 0!==o)){if(void 0===o||o.used+parseInt(e.columns,10)+parseInt(e.offset,10)>e.owner.options.columns||1==e.forceRow){(o=t).id=gform.getUID(),o.used=0;var a="<div></div>";"function"==typeof gform.types[e.type].row&&(a=gform.types[e.type].row.call(e)||a),o.ref=gform.create(a),o.ref.setAttribute("id",o.id),o.ref.setAttribute("class",e.owner.options.rowClass),o.ref.setAttribute("style","margin-bottom:0;"),"string"==typeof gform.types[e.type].rowSelector&&(o.appender=o.ref.querySelector(gform.types[e.type].rowSelector)),"appender"in o&&null!=o.appender||(o.appender=o.ref),e.operator.rows=e.operator.rows||[],e.operator.rows.push(o),o.container=n,n.appendChild(o.ref)}o.used+=parseInt(e.columns,10),o.used+=parseInt(e.offset,10)}i||o.appender.appendChild(e.el),e.row=o.id}}},gform.arrayManager=function(e){e=_.reduce(["reflow","find","filter"],(function(e,t){return t in gform.types[e.type]&&(e[t]=gform.types[e.type][t].bind(e)),e}),e),this.field=e,this.name=this.field.name,this.owner=e.owner,this.array=e.array,this.parsable=!0,this.focus=function(){},this.type=e.type,this.satisfied=function(){return!0},this.fields=[],this.instances=[],this.el=gform.create(gform.types[this.field.type].row.call(this.field)),this.container=this.el,"string"==typeof gform.types[e.type].rowSelector&&(this.container=this.el.querySelector(gform.types[this.field.type].rowSelector)),this.field.operator=this,Object.defineProperty(this,"map",{get:function(){if(!1===this.field.item.map)return this.field.item.map;var e="";return this.field.ischild&&(e=this.field.parent.map+"."),e+=this.field.name,this.field.item.map||e}}),Object.defineProperty(this,"toJSON",{get:function(){return this.get()}}),0!==e.array.min&&(this.instances[0]=e),gform.types[e.type].row,this.get=function(){return[]},this.addField=function(e,t){void 0===t&&(t=this.field);var i,n=this.instances.length;if(t.editable&&n<(t.array.max||5)){var r=_.findIndex(this.instances,{id:t.id}),o={};o[t.name]=[e||t.item.value||null],i=gform.createField.call(t.owner,t.parent,o,t.el,null,_.extend({},t.item,{array:t.array}),null,null,n,this),this.instances.splice(r+1,0,i),gform.addConditions.call(t.owner,i),gform.each.call(i,gform.addConditions),_.each(_.filter(this.instances,(function(e){return e.name==t.name&&void 0!==e.array&&!!e.array})),(function(e,t){e.index=t,gform.types[e.type].setLabel.call(e)})),gform.each.call(this.instances,(function(e){e.owner.trigger("change",e)})),gform.types[i.type].focus.call(i),t.parent.trigger(["change","input","create","inserted"],t),n++}return t.owner.updateActions(t),i},this.removeField=function(e){var t=this.instances.length;if(e.editable&&t>(e.array.min||0)){void 0!==e.eventlist&&_.each(e.owner.eventBus.handlers,(function(t,i,n){_.each(t,(function(t,i,n,r){_.each(e.eventlist,function(e,i,n){t==n&&delete i[e]}.bind(null,i,n))})),n[i]=_.compact(n[i])}));var i=_.findIndex(this.instances,{id:e.id});this.instances[i].el.parentElement.removeChild(this.instances[i].el),this.instances.splice(i,1),_.each(_.filter(this.instances,(function(t){return t.name==e.name&&void 0!==t.array&&!!t.array})),(function(e,t){e.index=t,gform.types[e.type].setLabel.call(e)})),e.parent.trigger(["change","input","removed"],e),t--}else e.editable&&e.set(null),e.parent.trigger(["input"],e);e.owner.updateActions(e)}},gform.field={cultivate:function(e){return(t,n)=>{if(t={parent:e,owner:e,data:{},el:null,instance:null,am:null,...t},(n=e.fieldMethods.normalize(t,n)).owner=e,"object"==typeof t.data&&"data"in t.data&&Object.defineProperty(n,"data",{get:function(){return e.options.data.data},enumerable:!0}),n.columns=n.columns>e.options.columns?e.options.columns:n.columns,n.array&&!n.am){let i={owner:e,type:"am",instances:[],id:gform.getUID(),get:function(){return _.map(this.instances,e=>e.get())}};return n.am=i,n.name in t.data&&"object"==typeof t.data[n.name]&&(i.instances=_.map(t.data[n.name],(i,r)=>e.fieldMethods.cultivate({...t,data:i,index:r},n))),i.addField=function(i,n){void 0===n&&(n=this.field);var r,o=this.instances.length;if(n.editable&&o<(n.array.max||5)){var a=_.findIndex(this.instances,{id:n.id}),s={};s[n.name]=[i||n.item.value||null],r=e.fieldMethods.cultivate({...t,data:s,index:a},_.extend({},n.item,{array:n.array})),this.instances.splice(a+1,0,r),gform.addConditions.call(n.owner,r),gform.each.call(r,gform.addConditions),_.each(_.filter(this.instances,(function(e){return e.name==n.name&&void 0!==e.array&&!!e.array})),(function(e,t){e.index=t,gform.types[e.type].setLabel.call(e)})),gform.each.call(this.instances,(function(e){e.owner.trigger("change",e)})),gform.types[r.type].focus.call(r),n.parent.trigger(["change","input","create","inserted"],n),o++}return n.owner.updateActions(n),r},i.removeField=function(e){var t=this.instances.length;if(e.editable&&t>(e.array.min||0)){void 0!==e.eventlist&&_.each(e.owner.eventBus.handlers,(function(t,i,n){_.each(t,(function(t,i,n,r){_.each(e.eventlist,function(e,i,n){t==n&&delete i[e]}.bind(null,i,n))})),n[i]=_.compact(n[i])}));var i=_.findIndex(this.instances,{id:e.id});this.instances[i].el.parentElement.removeChild(this.instances[i].el),this.instances.splice(i,1),_.each(_.filter(this.instances,(function(t){return t.name==e.name&&void 0!==t.array&&!!t.array})),(function(e,t){e.index=t,gform.types[e.type].setLabel.call(e)})),e.parent.trigger(["change","input","removed"],e),t--}else e.editable&&e.set(null),e.parent.trigger(["input"],e);e.owner.updateActions(e)},i}if(n.fillable){const i=t.data[n.name];if(e.options.strict)n.array&&"object"==typeof i?n.value=i||{}:n.value=_.defaults({value:_.selectPath(t.data,n.item.map||n.name)},n).value;else{const r=e.options.data[n.name];n.array&&"object"==typeof(i||r)?n.value=(i||r)[t.index||0]||{}:n.value=_.defaults({data:_.selectPath(t.data,n.item.map||n.name)},{value:r},n).value}}(n=_.reduce(["value","label","placeholder","help","info","pre","post"],(function(e,t){return"string"==typeof e[t]&&!0!==e.raw&&(e[t]=gform.renderString("string"==typeof e.item[t]?e.item[t]:e[t],e)),e}),n)).array&&n.fillable&&"object"==typeof t.data[n.name]&&t.data[n.name]?n.value=t.data[n.name][t.index||0]:"function"==typeof n.item.value||"string"==typeof n.item.method&&"function"==typeof n.owner.methods[n.item.method]?(n.valueFunc=n.owner.methods[n.item.method]||n.item.value,n.derivedValue=function(e){return e.initial.valueFunc.call(null,e)},n.value=n.valueFunc.call(null,{form:this.owner,field:n,initial:n}),n.owner.on("initialized",function(e,t){t.field=t.initial=e,e.set.call(null,e.derivedValue.call(null,t))}.bind(null,n)),n.owner.on("input",function(e,t){t.initial=e;var i=e.value,n=e.derivedValue.call(null,t);n!=i&&t.default&&(e.set.call(null,n),t.field!==e&&t.continue&&t.form.trigger("input",e))}.bind(null,n))):"string"==typeof n.item.value&&0===n.item.value.indexOf("=")?(n.derivedValue=function(){var e=this.owner.get();n.formula=gform.renderString(this.item.value.substr(1),e);try{if(n.formula.length&&"undefined"!=typeof math){var t=math.eval(n.formula,e);"object"==typeof t&&"undefined"!==t.entries&&"object"==typeof(t=_.last(t.entries))._data&&(t=t._data),_.isFinite(t)?n.formula=t.toFixed(this.item.precision||0):_.isArray(t)?n.formula=t:n.formula=""}}catch(e){n.formula=""}return n.formula},n.value=n.derivedValue.call(f,{form:n.owner,field:n}),n.owner.on("input",function(e,t){t.initial=e,e.set.call(null,e.derivedValue.call(null,t))}.bind(null,n)),n.owner.on("initialized",function(e,t){t.field=t.initial=e,e.set.call(null,e.derivedValue.call(null,t))}.bind(null,n))):n.fillable&&(n.value=_.defaults({value:_.selectPath(t.data,n.item.map||n.name)},n,{value:""}).value),n.trigger=gform.types[n.type].trigger?gform.types[n.type].trigger.bind(n):n.parent.trigger,n.set=function(e,t){"fields"in this&&"object"==typeof e&&(e=_.pick(e,_.map(this.fields,"name"))),this.value==e&&null!=e||gform.types[this.type].set.call(this,e)||(this.value=e,t||this.trigger(["change"],this))}.bind(n),Object.defineProperty(n,"active",{get:()=>n.isActive&&n.parent.active&&n.editable&&n.parsable&&n.visible,enumerable:!0}),Object.defineProperty(n,"display",{get:()=>"display"in n.item&&"function"==typeof n.item.display?n.display.call(n):"display"in gform.types[n.type]?gform.types[n.type].display.call(n):n.toString(),enumerable:!0}),Object.defineProperty(n,"sibling",{get:()=>{var e=n.parent.filter({array:{ref:n.array.ref}},1);return e.length&&e[0]!==n},enumerable:!0}),Object.defineProperty(n,"isSatisfied",{get:()=>n.satisfied(n.get())}),Object.defineProperty(n,"path",{get:()=>{let e="/";return n.ischild&&(e=n.parent.path+"."),e+=n.name,n.array&&(e+="."+n.id),e}}),Object.defineProperty(n,"map",{get:()=>{if(!1===n.item.map)return n.item.map;let e="";return n.ischild&&(e=n.parent.map+"."),e+=n.name,n.array&&(e+="."+n.index),n.item.map||e}}),Object.defineProperty(n,"source",{get:()=>{if(!1===n.item.source)return n.item.source;var e="";return n.ischild&&(e=n.parent.source+"."),e+=n.name,n.array&&(e+="."+n.index),n.item.source||e||n.map}}),Object.defineProperty(n,"relative",{get:function(){var e="/";return n.ischild&&(e=n.parent.relative+"."),e+=n.name}});switch((n=_.reduce(["get","toString","satisfied","render","update","destroy","focus","reflow","find","filter"],(t,i)=>(!(i in t)&&i in gform.types[t.type]&&(t[i]=e.bind(i,t)),t),n)).el=e.call("create",n),typeof n.container){case"string":n.container=n.el.querySelector(n.container);break;case"undefined":n.container=n.el.querySelector("fieldset")||n.el||null}return n.section&&e.el.querySelector("."+e.options.sections+"-content").appendChild(n.el),e.call("initialize",n),n.isActive=!0,_.isArray(n.item.data)&&(n.meta=n.item.data,_.each(n.meta,(function(e){"string"!=typeof e.key||""===e.key||e.key in n||Object.defineProperty(n,e.key,{get:function(e,t){return _.find(t.meta,{key:e}).value}.bind(null,e.key,n),set:function(t,i,n){_.find(i.meta,{key:t}).value=n,i.parent.trigger(e.key,i)}.bind(null,i.key,n),configurable:!0,enumerable:!0})}))),n.fields&&(this.items=_.map(n.fields,e.fieldMethods.cultivate.bind(null,{data:t.data,parent:n})),n.fields=_.reduce(this.items,(e,t)=>("am"===t.type?e=e.concat(t.instances):e.push(t),e),[])),n}},normalize:function(e){return(t,i)=>{var n=t.parent||e;"type"in i&&i.type in gform.types||(console.warn('Field type "'+i.type+'" not supported - using '+(e.options.default.type||"text")+" instead"),i.type=e.options.default.type),i.item=_.clone(i);const{index:r,id:o,...a}=i;return(i={id:gform.getUID(),index:t.index||r||i.instance||0,label:i.legend||i.title||(gform.types[i.type]||gform.types.text).defaults.label||i.name,parent:n,columns:t.columns||e.options.columns,offset:t.offset||gform.offset||0,ischild:!(n instanceof gform),...e.options.default,...(gform.types[i.type]||gform.types.text).defaults,...a}).array&&("object"!=typeof i.array&&(i.array={}),i.array=_.defaultsDeep(i.array,(gform.types[i.type]||{}).array,{max:5,min:1,duplicate:{enable:"auto"},remove:{enable:"auto"},append:{enable:!0}}),i.array.ref=i.array.ref||gform.getUID()),!("multiple"in i)&&"limit"in i&&i.limit>1&&(i.multiple=!0),i.name=i.name||(gform.renderString(i.legend||i.label||i.title,i)||"").toLowerCase().split(" ").join("_"),""==i.name&&(i.name=i.id),i}}};
gform.processConditions=function(e,n){if("string"==typeof e&&("show"!==e&&"edit"!==e&&"parse"!==e||(e=this.item[e]),"string"==typeof e&&0==e.indexOf("method:")&&void 0!==this.owner.methods&&"function"==typeof this.owner.methods[e.split("method:")[1]]&&n.call(this,this.owner.methods[e.split("method:")[1]].call(null,{form:this.owner,field:this}),{form:this.owner,field:this})),"boolean"==typeof e&&n.call(this,e,{form:this.owner,field:this}),"function"==typeof e&&n.call(this,e.call(null,{form:this.owner,field:this}),{form:this.owner,field:this}),"object"==typeof e){var t=function(e,n,t){n.call(this,gform._rules.call(this,e),t)}.bind(this,e,n);gform._subscribeByName.call(this,e,t)}return!0},gform._subscribeByName=function(e,n){if(this.owner instanceof gform)for(var t in e)if("object"==typeof e[t].conditions)gform._subscribeByName.call(this,e[t].conditions,n);else{var a=this.parent.find(e[t].name||this.name);0!==(e[t].name||this.name).indexOf("/")&&void 0!==a?(this.eventlist=this.eventlist||[],this.owner.on("change:"+a.path,n,this.eventlist)):this.owner.on("change:"+(e[t].name||this.name),n)}},gform._rules=function(e,n){n=n||"and";return _.reduce(e,function(e,t){var a;return a=void 0!==t.conditions?gform._rules.call(this,t.conditions,t.op):gform.conditions[t.type](this,t),"or"==n?e||a:e&&a}.bind(this),"and"==n)},gform.conditions={requires:function(e,n){var t;if(void 0!==n.name&&n.name){var a=e.parent.filter({name:n.name,parsable:!0},n.depth||10);if(a.length>0)t=a[0];else if(e.name==n.name)t=e;else if(void 0===(t=e.parent.find(n.name)||e.owner.filter({path:n.name},n.depth||10)[0]))return!1}else t=e;return t.satisfied()},not_matches:function(e,n){var t;if(void 0!==n.name&&n.name){var a=e.parent.filter({name:n.name,parsable:!0},n.depth||10);if(a.length>0)t=a[0];else if(e.name==n.name)t=e;else if(void 0===(t=e.parent.find(n.name)||e.owner.filter({path:n.name},n.depth||10)[0]))return!1}else t=e;var i=n[n.attribute||"value"],r=t[n.attribute||"value"];return"object"==typeof i&&null!==i&&null!==r?-1==i.indexOf(r):i!==r},test:function(e,n){return n.test.call(this,e,n)},contains:function(e,n){var t;if(void 0!==n.name&&n.name){var a=e.parent.filter({name:n.name,parsable:!0},n.depth||10);if(a.length>0)t=a[0];else if(e.name==n.name)t=e;else if(void 0===(t=e.parent.find(n.name)||e.owner.filter({path:n.name},n.depth||10)[0]))return!1}else t=e;var i=n.value,r=t,l=null;if(void 0!==r)l=0!=r.array?e.parent.find(n.name).parent.get()[n.name]:r.value;else if(void 0===(t=e.parent.find(n.name)||e.owner.filter({path:n.name},n.depth||10)[0]))return!1;return"object"!=typeof i||null===i||null===l?void 0!==l&&-1!==l.indexOf(i):"object"==typeof l?_.intersection(i,l).length>0:"string"==typeof l?_.some(i,(function(e){return l.indexOf(e)>=0})):void 0},matches:function(e,n){var t;if(void 0!==n.name&&n.name){var a=e.parent.filter({name:n.name,parsable:!0},n.depth||10);if(a.length>0)t=a[0];else if(e.name==n.name)t=e;else if(void 0===(t=e.parent.find(n.name)||e.owner.filter({path:n.name},n.depth||10)[0]))return!1}else t=e;var i=n[n.attribute||"value"],r=t[n.attribute||"value"];return"object"==typeof i&&null!==i&&null!==r?-1!==i.indexOf(r):i==r},matches_bool:function(e,n){var t;if(void 0!==n.name&&n.name){var a=e.parent.filter({name:n.name,parsable:!0},n.depth||10);if(a.length>0)t=a[0];else if(e.name==n.name)t=e;else if(void 0===(t=e.parent.find(n.name)||e.owner.filter({path:n.name},n.depth||10)[0]))return!1}else t=e;var i=n[n.attribute||"value"],r=t[n.attribute||"value"];return("false"==i||!i)==("false"==r||!r)},matches_numeric:function(e,n){var t;if(void 0!==n.name&&n.name){var a=e.parent.filter({name:n.name,parsable:!0},n.depth||10);if(a.length>0)t=a[0];else if(e.name==n.name)t=e;else if(void 0===(t=e.parent.find(n.name)||e.owner.filter({path:n.name},n.depth||10)[0]))return!1}else t=e;var i=n[n.attribute||"value"],r=parseInt(t[n.attribute||"value"]);return"object"==typeof i&&null!==i&&null!==r?-1!==_.map(i,(function(e){return parseInt(e)})).indexOf(r):parseInt(i)==r},numeric:function(e,n){var t;if(void 0!==n.name&&n.name){var a=e.parent.filter({name:n.name,parsable:!0},n.depth||10);if(a.length>0)t=a[0];else if(e.name==n.name)t=e;else if(void 0===(t=e.parent.find(n.name)||e.owner.filter({path:n.name},n.depth||10)[0]))return!1}else t=e;var i=n[n.attribute||"value"],r=parseInt(t[n.attribute||"value"]);return gform.regex.decimal.test(value)||""===value?(n.min="number"==typeof this.min?this.min:"number"==typeof n.min?n.min:null,null!==n.min&&parseFloat(value)<parseFloat(n.min)?"{{label}} must contain a number not less than {{args.min}} ":(n.max="number"==typeof this.max?this.max:"number"==typeof n.max?n.max:null,null!==n.max&&parseFloat(value)>parseFloat(n.max)?"{{label}} must contain a number not more than {{args.max}}":"object"==typeof i&&null!==i&&null!==r?-1!==_.map(i,(function(e){return parseInt(e)})).indexOf(r):parseInt(i)==r)):"{{label}} must contain only numbers"}};
gform.prototype.validate=function(e){return this.valid=!0,_.each(this.fields,gform.validateItem.bind(null,e)),this.valid?this.trigger("valid"):this.trigger("invalid",{errors:this.errors}),this.trigger("validation"),this.valid},gform.handleError=gform.update,gform.validateItem=function(e,t){var r=t.get();if((e||!t.valid||t.required||t.satisfied(r))&&(t.valid=!0,t.errors="",t.parsable&&"object"==typeof t.validate)){var a=[];if(t.required){var i=!t.satisfied(t.get())&&"{{label}} is required";i&&a.push(gform.renderString(t.required.message||i,{label:t.label,value:r,args:t.required}))}a.length||(a=gform.validation.call(t,t.validate)),a=_.compact(a),(void 0===t.display||t.visible)&&(t.valid=!a.length,t.errors=a.join("<br>"),gform.handleError(t))}t.parsable&&void 0!==t.fields&&_.each(t.fields,gform.validateItem.bind(null,e)),t.errors?t.owner.trigger("invalid:"+t.name,{errors:t.errors}):t.owner.trigger("valid:"+t.name),t.owner.errors[t.name]=t.errors,t.owner.errors=_.pickBy(t.owner.errors),t.owner.valid=t.valid&&t.owner.valid},gform.validation=function(e,t){t=t||"and";var r=this.get(),a=_.map(e,function(e,t){if("string"==typeof t.type){if(void 0===t.conditions||gform._rules.call(this,t.conditions)){var a=e[t.type].call(this,r,t);if(a)return gform.renderString(t.message||a,{label:this.label,value:r,args:t})}}else if(void 0!==t.tests)return gform.validation.call(this,t.tests,t.op).join("<br>")}.bind(this,gform.validations));return"and"==t||_.compact(a).length==e.length?a:[]},gform.regex={numeric:/^[0-9]+$/,decimal:/^\-?[0-9]*\.?[0-9]*$/,url:/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/,date:/^(0[1-9]|1[0-2])\/(0[1-9]|1\d|2\d|3[01])\/(19|20)\d{2}$/,email:/^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,6}$/i},gform.validations={none:function(e){return!1},required:function(e){return!this.satisfied(e)&&"{{label}} is required"},unique:function(e){return this.parent.get()[this.name].indexOf(this.value)!=this.index&&"{{label}} is a duplicate"},pattern:function(e,t){var r=t.regex;return"string"==typeof r&&(r=void 0!==gform.regex[r]?gform.regex[r]:new RegExp(t.regex,t.flags)),!r.test(e)&&""!==e&&t.message},custom:function(e,t){return("function"==typeof t.test||"string"==typeof t.test&&"function"==typeof this.owner.methods[t.test])&&(t.test=this.owner.methods[t.test]||t.test),t.field=this,t.form=this.owner,t.value=e,t.test.call(null,t)},matches:function(e,t){if(void 0!==t.name){var r=this.parent.find(t.name);return void 0===r?"Matching field not defined":(t.label=r.label,t.value=r.get(),e!=t.value&&'"{{label}}" does not match the "{{args.label}}" field')}if(void 0!==t.value)return _.isArray(t.value)?-1===t.value.indexOf(e)&&'"{{label}}" does not match "{{args.value}}"':e!=t.value&&'"{{label}}" does not match "{{args.value}}"'},date:function(e){return!gform.regex.date.test(e)&&""!==e&&"{{label}} should be in the format MM/DD/YYYY"},valid_url:function(e){return!gform.regex.url.test(e)&&""!==e&&"{{label}} must contain a valid Url"},valid_email:function(e){return!gform.regex.email.test(e)&&""!==e&&"{{label}} must contain a valid email address"},length:function(e,t){return gform.regex.numeric.test(t.max)||gform.regex.numeric.test(t.min)?"number"==typeof t.max&&"number"==typeof t.min&&t.min==t.max?t.min!=e.length&&"{{label}} must be exactly "+t.min+" characters in length":"number"==typeof t.max&&e.length>t.max?"{{label}} must not exceed "+t.max+" characters in length":"number"==typeof t.min&&e.length>0&&e.length<t.min&&"{{label}} must be at least "+t.min+" characters in length":"Invalid length requirement"},numeric:function(e,t){return gform.regex.decimal.test(e)||""===e?(t.min="number"==typeof parseFloat(this.min)?parseFloat(this.min):"number"==typeof parseFloat(t.min)?parseFloat(t.min):null,null!==t.min&&parseFloat(e)<parseFloat(t.min)?"{{label}} must contain a number not less than {{args.min}} ":(t.max="number"==typeof parseFloat(this.max)?parseFloat(this.max):"number"==typeof parseFloat(t.max)?parseFloat(this.max):null,null!==t.max&&parseFloat(e)>parseFloat(t.max)?"{{label}} must contain a number not more than {{args.max}}":void 0)):"{{label}} must contain only numbers"}};
